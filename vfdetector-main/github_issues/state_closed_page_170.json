[{"number": 49675, "title": "Refactor Xtensa conv kernels.", "body": "Moved Hifimini and Hifi specific code into their own cc files to make it easier to read and have the ability to add a basic framework to merge optimizations for the Vision P6 as well.\r\n\r\nManually tested the kernel_conv_test on hifimini, fusion_f1, hifi5 and vision_p6:\r\n\r\n```\r\nmake -f tensorflow/lite/micro/tools/make/Makefile TARGET=xtensa OPTIMIZED_KERNEL_DIR=xtensa TARGET_ARCH=hifimini XTENSA_CORE=mini1m1m_RG test_kernel_conv_test -j8\r\nmake -f tensorflow/lite/micro/tools/make/Makefile TARGET=xtensa TARGET_ARCH=fusion_f1 OPTIMIZED_KERNEL_DIR=xtensa XTENSA_CORE=F1_190305_swupgrade kernel_conv_test -j8\r\nmake -f tensorflow/lite/micro/tools/make/Makefile TARGET=xtensa OPTIMIZED_KERNEL_DIR=xtensa TARGET_ARCH=hifi5 XTENSA_CORE=AE_HiFi5_LE5_AO_FP_XC test_kernel_conv_test -j8\r\nmake -f tensorflow/lite/micro/tools/make/Makefile TARGET=xtensa OPTIMIZED_KERNEL_DIR=xtensa TARGET_ARCH=vision_p6 XTENSA_CORE=P6_200528 test_kernel_conv_test -j8\r\n```\r\n\r\nBug: http://b/189255344\r\n", "comments": ["Thanks for contributing to TensorFlow Lite Micro.\n\nTo keep this process moving along, we'd like to make sure that you have completed the items on this list:\n   * Read the [contributing guidelines for TensorFlow Lite Micro](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/lite/micro/CONTRIBUTING.md)\n   * Created a [TF Lite Micro Github issue](https://github.com/tensorflow/tensorflow/issues/new?labels=comp%3Amicro&template=70-tflite-micro-issue.md)\n   * Linked to the issue from the PR description\n   \n\nWe would like to have a discussion on the Github issue first to determine the best path forward, and then proceed to the PR review.\n"]}, {"number": 49674, "title": "Fix OOB read issue with `tf.raw_ops.CTCLoss`.", "body": "PiperOrigin-RevId: 372242187\nChange-Id: I347228ed8c04e1d2eb9d2479ae52f51d1b512c6e", "comments": []}, {"number": 49673, "title": "Fix OOB read issue with `tf.raw_ops.CTCLoss`.", "body": "PiperOrigin-RevId: 372242187\nChange-Id: I347228ed8c04e1d2eb9d2479ae52f51d1b512c6e", "comments": []}, {"number": 49672, "title": "Fix OOB read issue with `tf.raw_ops.CTCLoss`.", "body": "PiperOrigin-RevId: 372242187\nChange-Id: I347228ed8c04e1d2eb9d2479ae52f51d1b512c6e", "comments": []}, {"number": 49671, "title": "Fix OOB read issue with `tf.raw_ops.CTCLoss`.", "body": "PiperOrigin-RevId: 372242187\nChange-Id: I347228ed8c04e1d2eb9d2479ae52f51d1b512c6e", "comments": []}, {"number": 49670, "title": "Fix nullptr deref in `tf.raw_ops.CTCLoss`.", "body": "PiperOrigin-RevId: 372266334\nChange-Id: Ic52c3e9f13a38f54482d670907eda1688450862b", "comments": []}, {"number": 49669, "title": "Fix nullptr deref in `tf.raw_ops.CTCLoss`.", "body": "PiperOrigin-RevId: 372266334\nChange-Id: Ic52c3e9f13a38f54482d670907eda1688450862b", "comments": []}, {"number": 49668, "title": "Fix nullptr deref in `tf.raw_ops.CTCLoss`.", "body": "PiperOrigin-RevId: 372266334\nChange-Id: Ic52c3e9f13a38f54482d670907eda1688450862b", "comments": []}, {"number": 49667, "title": "Fix nullptr deref in `tf.raw_ops.CTCLoss`.", "body": "PiperOrigin-RevId: 372266334\nChange-Id: Ic52c3e9f13a38f54482d670907eda1688450862b", "comments": []}, {"number": 49666, "title": "[CherryPick]Add missing validation, prevent heap OOB", "body": null, "comments": ["All (the pull request submitter and all commit authors) CLAs are signed, **but** one or more commits were authored or co-authored by someone other than the pull request submitter.\n\nWe need to confirm that all authors are ok with their commits being contributed to this project.  Please have them confirm that by leaving a comment that contains only `@googlebot I consent.` in this pull request.\n\n*Note to project maintainer:* There may be cases where the author cannot leave a comment, or the comment is not properly detected as consent.  In those cases, you can manually confirm consent of the commit author(s), and set the `cla` label to `yes` (if enabled on your project).\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F49666) for more info**.\n\n<!-- need_author_consent -->"]}, {"number": 49665, "title": "[CherryPick]Add missing validation, prevent heap OOB", "body": null, "comments": ["All (the pull request submitter and all commit authors) CLAs are signed, **but** one or more commits were authored or co-authored by someone other than the pull request submitter.\n\nWe need to confirm that all authors are ok with their commits being contributed to this project.  Please have them confirm that by leaving a comment that contains only `@googlebot I consent.` in this pull request.\n\n*Note to project maintainer:* There may be cases where the author cannot leave a comment, or the comment is not properly detected as consent.  In those cases, you can manually confirm consent of the commit author(s), and set the `cla` label to `yes` (if enabled on your project).\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F49665) for more info**.\n\n<!-- need_author_consent -->"]}, {"number": 49664, "title": "[CherryPick]Add missing validation, prevent heap OOB", "body": null, "comments": ["All (the pull request submitter and all commit authors) CLAs are signed, **but** one or more commits were authored or co-authored by someone other than the pull request submitter.\n\nWe need to confirm that all authors are ok with their commits being contributed to this project.  Please have them confirm that by leaving a comment that contains only `@googlebot I consent.` in this pull request.\n\n*Note to project maintainer:* There may be cases where the author cannot leave a comment, or the comment is not properly detected as consent.  In those cases, you can manually confirm consent of the commit author(s), and set the `cla` label to `yes` (if enabled on your project).\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F49664) for more info**.\n\n<!-- need_author_consent -->"]}, {"number": 49663, "title": "[CherryPick]Add missing validation, prevent heap OOB", "body": null, "comments": ["All (the pull request submitter and all commit authors) CLAs are signed, **but** one or more commits were authored or co-authored by someone other than the pull request submitter.\n\nWe need to confirm that all authors are ok with their commits being contributed to this project.  Please have them confirm that by leaving a comment that contains only `@googlebot I consent.` in this pull request.\n\n*Note to project maintainer:* There may be cases where the author cannot leave a comment, or the comment is not properly detected as consent.  In those cases, you can manually confirm consent of the commit author(s), and set the `cla` label to `yes` (if enabled on your project).\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F49663) for more info**.\n\n<!-- need_author_consent -->"]}, {"number": 49662, "title": "Add missing validation to pooling_ops_3d", "body": "PiperOrigin-RevId: 372218727\nChange-Id: I6b9ed4266aa7286c02f1f230d7bea922c1be547e", "comments": []}, {"number": 49661, "title": "Add missing validation to pooling_ops_3d", "body": "PiperOrigin-RevId: 372218727\nChange-Id: I6b9ed4266aa7286c02f1f230d7bea922c1be547e", "comments": []}, {"number": 49660, "title": "Add missing validation to pooling_ops_3d", "body": "PiperOrigin-RevId: 372218727\nChange-Id: I6b9ed4266aa7286c02f1f230d7bea922c1be547e", "comments": []}, {"number": 49659, "title": "Add missing validation to pooling_ops_3d", "body": "PiperOrigin-RevId: 372218727\nChange-Id: I6b9ed4266aa7286c02f1f230d7bea922c1be547e", "comments": []}, {"number": 49658, "title": "Unsupported TF Select ops: AddV2, Mul, Pad", "body": "### System information\r\n\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 18.04):\r\n- TensorFlow installation (pip package):\r\n- TensorFlow library ( 2.5.0 ):\r\n\r\n### Problem\r\nI have an ONNX model, which itself is originated from pytorch. I'm trying to convert from ONNX format to tensorflow lite format without using Select ops.\r\nFirst, I convert to TF SavedModel via onnx-tensorflow package, then I convert to TFLite with basic API:\r\n\r\n```python\r\nconverter = tf.lite.TFLiteConverter.from_saved_model( name )\r\nconverter.target_spec.supported_ops = [tf.lite.OpsSet.TFLITE_BUILTINS]\r\n```\r\n\r\nI get the following errors:\r\n\r\n```bash\r\n...\r\n<unknown>:0: note: loc(\"PartitionedCall\"): called from\r\n<unknown>:0: error: loc(callsite(callsite(\"onnx_tf_prefix_Add_65@__inference___call___373\" at \"PartitionedCall@__inference_signature_wrapper_435\") at \"PartitionedCall\")): 'tf.AddV2' op is neither a custom op nor a flex op\r\n<unknown>:0: note: loc(\"PartitionedCall\"): called from\r\n<unknown>:0: error: failed while converting: 'main': \r\nSome ops are not supported by the native TFLite runtime, you can enable TF kernels fallback using TF Select. See instructions: https://www.tensorflow.org/lite/guide/ops_select \r\nTF Select ops: AddV2, Mul, Pad\r\nDetails:\r\n        tf.AddV2\r\n        tf.AddV2 {device = \"\"}\r\n        tf.Mul {device = \"\"}\r\n        tf.Pad {device = \"\"}\r\n```\r\n\r\nI've also had problem with SoftMax operator, but I've solved the issue. It turned out, that TFLite version of [softmax operator](https://www.tensorflow.org/api_docs/python/tf/nn/softmax) doesn't support axis parameter, so I removed it and now converter is able to use non-flex softmax.\r\nAll modifications I do on ONNX graph, before converting to Tensorflow\r\n\r\nWhat could be wrong with other operators: AddV2, Mul, Pad ?\r\n\r\n\r\n### What I tried\r\nI've noticed that [tfl.mul](https://www.tensorflow.org/mlir/tfl_ops#tflmul_tflmulop) docs don't tell anything about broadcasting compared to [tf.mul](https://www.tensorflow.org/mlir/tf_ops#tfmul_tfmulop). So my hypothesis was that non-flex tflite can multiply only tensors of the same shape, but can't multiply tensor by scalar. So I've replaced [Constant](https://github.com/onnx/onnx/blob/master/docs/Operators.md#Constant) with [Shape](https://github.com/onnx/onnx/blob/master/docs/Operators.md#Shape) -> [Cast](https://github.com/onnx/onnx/blob/master/docs/Operators.md#Cast) (to float32) -> [ConstantOfShape](https://github.com/onnx/onnx/blob/master/docs/Operators.md#ConstantOfShape) operators, but I still get the same errors.\r\n\r\nI've also tried to convert all tensors with datatype int64 to int32 - no success.\r\n\r\nAny suggestions? What do I have to pay attention first, when I get such select ops issues?\r\n\r\n", "comments": ["If you can fix the input shapes of AddV2 and Mul operators or lower input dimensions regardless of broadcasting support (e.g., input dim <= 4), those math operators can be replaced with the TFLite operators.\r\n\r\nIf you can lower the input dimension of the Pad operator (input dim <= 4), the converter will put the TFLite Pad op.", "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you.\n", "> \r\n> \r\n> If you can fix the input shapes of AddV2 and Mul operators or lower input dimensions regardless of broadcasting support (e.g., input dim <= 4), those math operators can be replaced with the TFLite operators.\r\n> \r\n> If you can lower the input dimension of the Pad operator (input dim <= 4), the converter will put the TFLite Pad op.\r\n\r\nThanks for solution! I'll experiment and try to reshape tensor before and after AddV2 and Mul operator (probably next week).\r\nI'll write here when I succeed.\r\n", "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/49658\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/49658\">No</a>\n", "So, I did the following things:\r\n1. Made all inmput dimensions in ONNX graph fixed, that fixed AddV2 and Mul operators\r\n2. Lowered dimension of input for Pad operator\r\n\r\nAnd this helped me to get rid of flex operators"]}, {"number": 49657, "title": "Don't do any work if output tensor is null (prevent div by 0)", "body": "PiperOrigin-RevId: 372208700\nChange-Id: Iea6b6293e887ade8538facfdb50fb931e17f511e", "comments": []}, {"number": 49656, "title": "Don't do any work if output tensor is null (prevent div by 0)", "body": "PiperOrigin-RevId: 372208700\nChange-Id: Iea6b6293e887ade8538facfdb50fb931e17f511e", "comments": []}, {"number": 49655, "title": "Don't do any work if output tensor is null (prevent div by 0)", "body": "PiperOrigin-RevId: 372208700\nChange-Id: Iea6b6293e887ade8538facfdb50fb931e17f511e", "comments": []}, {"number": 49654, "title": "Don't do any work if output tensor is null (prevent div by 0)", "body": "PiperOrigin-RevId: 372208700\nChange-Id: Iea6b6293e887ade8538facfdb50fb931e17f511e", "comments": []}, {"number": 49653, "title": "Add missing validations to reverse_sequence_op", "body": "PiperOrigin-RevId: 372178683\nChange-Id: Iac97ebab5b342f1262c77a7d9bcb4267b305ce5b", "comments": []}, {"number": 49652, "title": "Add missing validations to reverse_sequence_op", "body": "PiperOrigin-RevId: 372178683\nChange-Id: Iac97ebab5b342f1262c77a7d9bcb4267b305ce5b", "comments": []}, {"number": 49651, "title": "Add missing validations to reverse_sequence_op", "body": "PiperOrigin-RevId: 372178683\nChange-Id: Iac97ebab5b342f1262c77a7d9bcb4267b305ce5b", "comments": []}, {"number": 49650, "title": "Add missing validations to reverse_sequence_op", "body": "PiperOrigin-RevId: 372178683\nChange-Id: Iac97ebab5b342f1262c77a7d9bcb4267b305ce5b", "comments": []}, {"number": 49649, "title": "Add several missing validations in SDCA", "body": "PiperOrigin-RevId: 372172877\nChange-Id: Id366da962432e18dcbfac847d11e98488bebb70a", "comments": []}, {"number": 49648, "title": "Add several missing validations in SDCA", "body": "PiperOrigin-RevId: 372172877\nChange-Id: Id366da962432e18dcbfac847d11e98488bebb70a", "comments": []}, {"number": 49647, "title": "Add several missing validations in SDCA", "body": "PiperOrigin-RevId: 372172877\nChange-Id: Id366da962432e18dcbfac847d11e98488bebb70a", "comments": []}, {"number": 49646, "title": "Add several missing validations in SDCA", "body": "PiperOrigin-RevId: 372172877\nChange-Id: Id366da962432e18dcbfac847d11e98488bebb70a", "comments": []}]