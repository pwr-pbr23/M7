[{"number": 51940, "title": "cherry pick to r2.4", "body": "PiperOrigin-RevId: 391529518\r\nChange-Id: Ie3db4ae6d3c0f3dc88404e1dbdc22f7d03cbeb3b", "comments": ["\nThanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).\n\n:memo: **Please visit <https://cla.developers.google.com/> to sign.**\n\nOnce you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.\n\n----\n\n#### What to do if you already signed the CLA\n\n##### Individual signers\n\n*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n\n##### Corporate signers\n\n*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).\n*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).\n\t\t\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51940) for more info**.\n\n<!-- need_sender_cla -->", "@pranve Can you please sign CLA. Thanks!", "@googlebot I signed it!"]}, {"number": 51939, "title": "cherrypick to r2.5", "body": null, "comments": ["\nThanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).\n\n:memo: **Please visit <https://cla.developers.google.com/> to sign.**\n\nOnce you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.\n\n----\n\n#### What to do if you already signed the CLA\n\n##### Individual signers\n\n*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n\n##### Corporate signers\n\n*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).\n*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).\n\t\t\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51939) for more info**.\n\n<!-- need_sender_cla -->", "Merge conflict\r\n"]}, {"number": 51938, "title": "R2.4", "body": null, "comments": ["\nThanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).\n\n:memo: **Please visit <https://cla.developers.google.com/> to sign.**\n\nOnce you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.\n\n----\n\n#### What to do if you already signed the CLA\n\n##### Individual signers\n\n*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n\n##### Corporate signers\n\n*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).\n*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).\n\t\t\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51938) for more info**.\n\n<!-- need_sender_cla -->", "Merge Conflict \r\n"]}, {"number": 51937, "title": "cherry pick to 2.4", "body": null, "comments": ["\nThanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).\n\n:memo: **Please visit <https://cla.developers.google.com/> to sign.**\n\nOnce you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.\n\n----\n\n#### What to do if you already signed the CLA\n\n##### Individual signers\n\n*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n\n##### Corporate signers\n\n*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).\n*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).\n\t\t\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51937) for more info**.\n\n<!-- need_sender_cla -->", "\nThanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).\n\n:memo: **Please visit <https://cla.developers.google.com/> to sign.**\n\nOnce you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.\n\n----\n\n#### What to do if you already signed the CLA\n\n##### Individual signers\n\n*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n\n##### Corporate signers\n\n*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).\n*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).\n\t\t\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51937) for more info**.\n\n<!-- need_sender_cla -->"]}, {"number": 51936, "title": "tf.keras.layers.MaxPooling3D crashes", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): yes\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 18.04\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: n/a\r\n- TensorFlow installed from (source or binary): binary\r\n- TensorFlow version (use command below): 2.6.0\r\n- Python version: 3.6.8\r\n- Bazel version (if compiling from source): n/a\r\n- GCC/Compiler version (if compiling from source): n/a\r\n- CUDA/cuDNN version: n/a\r\n- GPU model and memory: n/a\r\n\r\n**Describe the current behavior**\r\n`tf.keras.layers.MaxPooling3D` crashes when `pool_size` contains `0`, and outputs a all-inf tensor when `pool_size` contains negative values.\r\n\r\n**Describe the expected behavior**\r\nExpect a `ValueError` to be thrown if the input `pool_size` contains zero or negative values.\r\n\r\n\r\n**Standalone code to reproduce the issue**\r\nIf the `pool_size` has `0`:\r\n```\r\nimport tensorflow as tf\r\npool_size = [2, 2, 0]\r\nlayer = tf.keras.layers.MaxPooling3D(strides=1, pool_size=pool_size)\r\ninput_tensor = tf.random.uniform([3, 4, 10, 11, 12], dtype=tf.float32)\r\nres = layer(input_tensor) # crash\r\n```\r\nOutputs:\r\n```\r\nFloating point exception (core dumped)\r\n```\r\nIf the `pool_size` has negative values:\r\n```\r\nimport tensorflow as tf\r\npool_size = [2, 2, -2]\r\nlayer = tf.keras.layers.MaxPooling3D(strides=1, pool_size=pool_size,)\r\ninput_tensor = tf.random.uniform([3, 4, 10, 11, 12], dtype=tf.float32)\r\nres = layer(input_tensor)\r\nprint(res)\r\n```\r\nThe output is a tensor with `shape`=`(3, 3, 9, 14, 12)` and all `inf` values.", "comments": ["It turns out that `tf.keras.layers.AveragePooling3D` also crashes when `pool_size` contains `0`.", "@lugalUrim Please post this issue on [keras-team/keras repo.](https://github.com/keras-team/keras/issues)\r\nTo know more see;\r\n[https://discuss.tensorflow.org/t/keras-project-moved-to-new-repository-in-https-github-com-keras-team-keras/1999](https://discuss.tensorflow.org/t/keras-project-moved-to-new-repository-in-https-github-com-keras-team-keras/1999)\r\nThank you!", "Hi, I have created a [PR](https://github.com/keras-team/keras/pull/15356) for Keras to solve this issue.", "While the original issue is coming from tf.keras.layers.MaxPooling3D, the issue is triggered when max_pool3d is called directly with tensorflow itself. For that PR #51975 has been created to fix the issue inside tensorflow.", "Thanks for the information @sushreebarsa, I will post new issues in the keras repo, but I guess we can keep this issue in tensorflow, as mentioned by @yongtang there are related bugs in the tensorflow operator implementations as well.", "Thank you @WingsBrokenAngel and @yongtang for your PRs! Actually here are more crash bugs I find when `pool_size`/`k_size` <= 0, so we may want to fix all of these in the codebase and also cover them in the unit tests.\r\n- `tf.keras.layers.AveragePooling1D`, `tf.keras.layers.AveragePooling2D`, `tf.keras.layers.AveragePooling3D`\r\n- `tf.keras.layers.MaxPooling1D`, `tf.keras.layers.MaxPooling2D`, `tf.keras.layers.MaxPooling3D`\r\n- `tf.nn.avg_pool1d`, `tf.nn.avg_pool2d`, `tf.nn.avg_pool3d`\r\n- `tf.nn.max_pool1d`, `tf.nn.max_pool2d`, `tf.nn.max_pool3d`\r\n", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51936\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51936\">No</a>\n"]}, {"number": 51935, "title": "\"Could not append to the internal temporary file\" When preparing TFDS imagenet dataset on TPU-VM", "body": "(1) please update the bug template to include instructs to get TF version properly ```python3 -c \"import tensorflow as tf; print(tf.__version__)\" ```\r\n\r\nvs. TF 2.0 instructions in this bug template: `python -c \"import tensorflow as tf; print(tf.version.GIT_VERSION, tf.version.VERSION)\"`\r\n\r\nThe former yields : 2.6.0\r\n\r\n(2) \r\n\r\n**System information**\r\nTPU-VM v3-8 with alpha 2.0 software and Colab Pro large memory instance.\r\n\r\nThis is a duplicate of [#37132](https://github.com/tensorflow/tensorflow/issues/37132) , but I believe the details were not flushed out hence I'm writing a new Issue.\r\nI use something like:\r\n```python\r\nimport tensorflow_datasets as tfds\r\nsource_dir='gs://MY_BUCKET/ILSVRC2012'\r\ndest_dir='gs:/MY_BUCKET/ILSVRC2012_tf_records'\r\ntfds.builder('imagenet2012',data_dir=dest_dir).download_and_prepare(\r\n    download_config=tfds.download.DownloadConfig(\r\n        manual_dir=source_dir))\r\n```\r\nIn my use case I'm using TFDS and trying to write the TF records to a bucket using my TPU-VM (granted generously by TRC \u2764\ufe0f which has 100GB as a root drive so 50-ish GB free space). half way through it completely fills the disk and the process of preparing the TF records fails.\r\n\r\nThis happens because of the default behavior for the GFile async writes, which is to store some tmp files in `/tmp` like:\r\n```\r\ntmp_file_tensorflow_539_EDt0Pl                                 tmp_file_tensorflow_994_lWEmew\r\ntmp_file_tensorflow_540_RdDgOX                                 tmp_file_tensorflow_995_yaqZEX\r\ntmp_file_tensorflow_541_rwyIRz                                 tmp_file_tensorflow_996_HDijKz\r\ntmp_file_tensorflow_542_XF4R0b                                 tmp_file_tensorflow_997_bxYY9g\r\ntmp_file_tensorflow_543_EVoGfO                                 tmp_file_tensorflow_998_HRem23\r\ntmp_file_tensorflow_544_ebDRzq                                 tmp_file_tensorflow_999_tPD8y1\r\ntmp_file_tensorflow_545_LK3B02                                 tmp_file_tensorflow_99_A7tVko\r\ntmp_file_tensorflow_546_MoRHwF                                 tmp_file_tensorflow_9_GI4Quq\r\n```\r\n with no ability to change it or override it IIUC, and TPU-VMs we can't edit `fstab` to mount another `/tmp` \ud83d\ude22 \r\nand changing `dest_dir` to a [secondary disk](https://cloud.google.com/tpu/docs/setup-persistent-disk?hl=en) doesn't help as TFDS insists on writing to `/tmp` \r\nI tried to do this with Colab pro (which has 180-ish GB free space), managed to get away almost with the entire process and after 4h 47m 47s I get:\r\n```\r\nDownloading and preparing dataset imagenet2012/5.1.0 (download: Unknown size, generated: 155.84 GiB, total: 155.84 GiB) to /content/MY_MOUNTED_GCS_FUSE_BUCKET/ILSVRC2012_tf_records/imagenet2012/5.1.0...\r\nShuffling and writing examples to /content/MY_MOUNTED_GCS_FUSE_BUCKET/ILSVRC2012_tf_records/imagenet2012/5.1.0.incompleteROAOS5/imagenet2012-train.tfrecord\r\n100%\r\n1281166/1281167 [1:49:37<00:00, 305.35 examples/s]\r\nShuffling and writing examples to /content/MY_MOUNTED_GCS_FUSE_BUCKET/ILSVRC2012_tf_records/imagenet2012/5.1.0.incompleteROAOS5/imagenet2012-validation.tfrecord\r\n100%\r\n49999/50000 [12:36<00:00, 80.58 examples/s]\r\nShuffling and writing examples to /content/MY_MOUNTED_GCS_FUSE_BUCKET/ILSVRC2012_tf_records/imagenet2012/5.1.0.incompleteROAOS5/imagenet2012-test.tfrecord\r\n100%\r\n99999/100000 [19:05<00:00, 118.47 examples/s]\r\n---------------------------------------------------------------------------\r\nResourceExhaustedError                    Traceback (most recent call last)\r\n<ipython-input-4-08cf32753112> in <module>()\r\n      4 tfds.builder('imagenet2012',data_dir=dest_dir).download_and_prepare(\r\n      5     download_config=tfds.download.DownloadConfig(\r\n----> 6         manual_dir=source_dir))\r\n\r\n3 frames\r\n/usr/local/lib/python3.7/dist-packages/tensorflow_datasets/core/dataset_builder.py in download_and_prepare(self, download_dir, download_config)\r\n    416           self.info.download_size = dl_manager.downloaded_size\r\n    417           # Write DatasetInfo to disk, even if we haven't computed statistics.\r\n--> 418           self.info.write_to_directory(self._data_dir)\r\n    419     self._log_download_done()\r\n    420 \r\n\r\n/usr/lib/python3.7/contextlib.py in __exit__(self, type, value, traceback)\r\n    117         if type is None:\r\n    118             try:\r\n--> 119                 next(self.gen)\r\n    120             except StopIteration:\r\n    121                 return False\r\n\r\n/usr/local/lib/python3.7/dist-packages/tensorflow_datasets/core/utils/py_utils.py in incomplete_dir(dirname)\r\n    343   try:\r\n    344     yield tmp_dir\r\n--> 345     tf.io.gfile.rename(tmp_dir, dirname)\r\n    346   finally:\r\n    347     if tf.io.gfile.exists(tmp_dir):\r\n\r\n/usr/local/lib/python3.7/dist-packages/tensorflow/python/lib/io/file_io.py in rename_v2(src, dst, overwrite)\r\n    622   \"\"\"\r\n    623   _pywrap_file_io.RenameFile(\r\n--> 624       compat.path_to_bytes(src), compat.path_to_bytes(dst), overwrite)\r\n    625 \r\n    626 \r\n\r\nResourceExhaustedError: /content/MY_MOUNTED_GCS_FUSE_BUCKET/ILSVRC2012_tf_records/imagenet2012/5.1.0.incompleteROAOS5; Too many open files\r\n\r\n```\r\nBoth issues in my head look like there are too many temp files being created (without cleanup) that it either fills the root drive or trips a requests quota.\r\n\r\nThoughts, Ideas, Advice?\r\n\r\n@skye FYI.\r\n\r\n", "comments": ["@mjsML ,\r\nCan you please try to test your code in latest stable tf v2.6 and let us know if the issue still persists.Thanks!", "@tilakrayal when I run this \r\n```python3\r\nimport tensorflow as tf; print(tf.version.GIT_VERSION, tf.version.VERSION)\r\n```\r\non my TPU-VM I get \r\n```\r\nunknown 2.6.0\r\n```\r\n\r\non Colab I get\r\n```\r\nv2.6.0-0-g919f693420e 2.6.0\r\n```\r\n\r\nboth `unknown` and `v2.6.0-0-g919f693420e` don't match the [release](https://github.com/tensorflow/tensorflow/releases/tag/v2.6.0)'s [tag](https://github.com/tensorflow/tensorflow/commit/919f693420e35d00c8d0a42100837ae3718f7927).\r\n\r\nRegardless of the `tf.version.GIT_VERSION` I assume that the version number (being .0 not .0.foo) is the stable version?\r\n\r\nIf not do you recommend specific steps to upgrade TF and not break `libtpu` ? ", "There is already an issue open in [tensorflow/datasets](https://github.com/tensorflow/datasets/issues/1441) repository, you can refer to the temporary solution mentioned in the same issue.", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "I see, I'll try the workaround and will report back.", "@mjsML , Could you please update the outcome.", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51935\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51935\">No</a>\n"]}, {"number": 51934, "title": "how i build this custom layer in keras without error?", "body": "I want build this custom Layer in keras to use it in sequential model. While running the code i am getting an error.can someone help me?? Below you can see the Code and the error.   \r\n\r\n    class WeightedLayer(Layer):\r\n      def __init__(self, n_input, n_memb, **kwargs):\r\n          super(WeightedLayer, self).__init__( **kwargs)\r\n          self.n = n_input   # 16 features\r\n          self.m = n_memb    # 3\r\n\r\n      def build(self, batch_input_shape):\r\n          super(WeightedLayer, self).build(batch_input_shape)\r\n\r\n      def call(self, input_):\r\n          CP = []\r\n          self.batch_size = tf.shape(input_)[0]\r\n          for batch in tf.range(self.batch_size):\r\n            xd_shape = [self.m]\r\n            c_shape = [1]\r\n            cp= input_[batch,0,:]\r\n            for d in range(1,self.n):\r\n                c_shape.insert(0,self.m)\r\n                xd_shape.insert(0,1)\r\n                xd = tf.reshape(input_[batch,d,:], (xd_shape))\r\n                c = tf.reshape(cp,(c_shape))\r\n                cp = tf.matmul(c , xd)\r\n\r\n            flat_cp = tf.reshape(cp,(1, self.m**self.n))\r\n            CP.append(flat_cp)\r\n          return tf.reshape(tf.stack(CP), (self.batch_size, self.m**self.n))\r\n\r\n      def compute_output_shape(self, batch_input_shape):\r\n        return tf.TensorShape([self.batch_size, self.m ** self.n])\r\n\r\n    X_train = np.random.uniform(0, 1, (200, 16, 3))\r\n    X_test = np.random.uniform(0, 1, (200, 16, 3))\r\n    y_train = np.random.uniform(0, 1, (200,))\r\n    y_test = np.random.uniform(0, 1, (200,))\r\n\r\n    Model = keras.models.Sequential()\r\n    Model.add(WeightedLayer(n_input=16, n_memb=3,input_shape=(16, 3)))\r\n    Model.compile(loss='mean_squared_error', optimizer='adam')\r\n    Model.fit(X_train, y_train,epochs=20,batch_size=10,validation_data=(X_test, y_test))\r\n\r\n\r\nI am getting a following error:\r\n\r\n          /usr/local/lib/python3.7/dist-packages/tensorflow/python/autograph/impl/api.py in wrapper(*args, **kwargs)\r\n          693       except Exception as e:  # pylint:disable=broad-except\r\n          694         if hasattr(e, 'ag_error_metadata'):\r\n    --> 695           raise e.ag_error_metadata.to_exception(e)\r\n          696         else:\r\n          697           raise\r\n\r\n    InaccessibleTensorError: in user code:\r\n\r\n    <ipython-input-66-5c6ffada5c7a>:29 call  *\r\n     return tf.reshape(tf.stack(CP), (self.batch_size, self.m**self.n))\r\n     /usr/local/lib/python3.7/dist-packages/tensorflow/python/util/dispatch.py:206 wrapper  **\r\n    return target(*args, **kwargs)\r\n     /usr/local/lib/python3.7/dist-packages/tensorflow/python/ops/array_ops.py:1424 stack\r\n    return gen_array_ops.pack(values, axis=axis, name=name)\r\n     /usr/local/lib/python3.7/dist-packages/tensorflow/python/ops/gen_array_ops.py:6401 pack\r\n    \"Pack\", values=values, axis=axis, name=name)\r\n     /usr/local/lib/python3.7/dist-packages/tensorflow/python/framework/op_def_library.py:750 _apply_op_helper\r\n    attrs=attr_protos, op_def=op_def)\r\n    /usr/local/lib/python3.7/dist-packages/tensorflow/python/framework/func_graph.py:597 _create_op_internal\r\n    inp = self.capture(inp)\r\n    /usr/local/lib/python3.7/dist-packages/tensorflow/python/framework/func_graph.py:647 capture\r\n    % (tensor, tensor.graph, self))\r\n\r\n    InaccessibleTensorError: The tensor 'Tensor(\"weighted_layer_37/while/Reshape_30:0\", shape=(1, 43046721), dtype=float32)' cannot be accessed here: it is defined in another function or code block. Use return values, explicit Python locals or TensorFlow collections to access it. Defined in: FuncGraph(name=weighted_layer_37_while_body_44082, id=139893449741456); accessed from: FuncGraph(name=weighted_layer_37_scratch_graph, id=139893452012688).", "comments": ["Hi @bouyeshogh ,\r\nPlease post this issue on [keras-team/keras repo.](https://github.com/keras-team/keras/issues)\r\nTo know more see;\r\n[https://discuss.tensorflow.org/t/keras-project-moved-to-new-repository-in-https-github-com-keras-team-keras/1999](https://discuss.tensorflow.org/t/keras-project-moved-to-new-repository-in-https-github-com-keras-team-keras/1999) . Thanks!", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51934\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51934\">No</a>\n"]}, {"number": 51933, "title": "How to edit Tensorflow SavedModel", "body": "I have a Tensorflow model trained in Python, exported to a .pb file and then used with Tensorflow Serving.\r\n\r\nI have written a custom op that greatly speeds up the inference of some operators in this Tensorflow model, but only works for inference -- I can't use this custom op during training time.\r\n\r\nI am wondering if it's possible for me to use this custom op with the .pb file in Tensorflow serving. I figure I will probably have to edit the .pb file such that it uses my custom op in place of the original op, and Tensorflow serving should then go about looking for the custom op implementation which I can link against its runtime.\r\n\r\nSo -- how does one go about modifying a Tensorflow .pb file and swap out operators? Are there example codes doing this that I can refer to?\r\n\r\nPlease help. Thank you very much.\r\n", "comments": ["@marsupialtail Could you please refer to the[ link1](https://www.tensorflow.org/tutorials/keras/save_and_load),[ link2](https://www.tensorflow.org/tutorials/keras/save_and_load) and let us know if it helps?Thanks!", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51933\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51933\">No</a>\n"]}, {"number": 51931, "title": "Why is there no get in tensorflow version 2.3_ output_ Shape this function\uff1f", "body": "https://github.com/tensorflow/tensorflow/blob/e5bf8de410005de06a7ff5393fafdf832ef1d4ad/tensorflow/python/keras/engine/base_layer.py#L1463-L1480", "comments": ["Hi @86236291 ,\r\nWe see that the issue template has not been filled, could you please do so as it helps us analyse the issue [tf version, steps followed before you ran into this error or stand alone code/colab gist to reproduce the issue faced].Thanks!", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n"]}, {"number": 51929, "title": "Semantic segmentation node in ros node opening with model ", "body": "2021-09-10 16:25:17.632603: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcudart.so.10.2\r\n2021-09-10 16:25:28.226278: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcuda.so.1\r\n2021-09-10 16:25:28.235986: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1001] ARM64 does not support NUMA - returning NUMA node zero\r\n2021-09-10 16:25:28.236470: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1734] Found device 0 with properties: \r\npciBusID: 0000:00:00.0 name: Xavier computeCapability: 7.2\r\ncoreClock: 1.377GHz coreCount: 8 deviceMemorySize: 31.17GiB deviceMemoryBandwidth: 82.08GiB/s\r\n2021-09-10 16:25:28.236749: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcudart.so.10.2\r\n2021-09-10 16:25:28.237093: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcublas.so.10\r\n2021-09-10 16:25:28.237299: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcublasLt.so.10\r\n2021-09-10 16:25:28.237466: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcufft.so.10\r\n2021-09-10 16:25:28.239481: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcurand.so.10\r\n2021-09-10 16:25:28.245080: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcusolver.so.10\r\n2021-09-10 16:25:28.249723: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcusparse.so.10\r\n2021-09-10 16:25:28.250319: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcudnn.so.8\r\n2021-09-10 16:25:28.251087: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1001] ARM64 does not support NUMA - returning NUMA node zero\r\n2021-09-10 16:25:28.251756: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1001] ARM64 does not support NUMA - returning NUMA node zero\r\n2021-09-10 16:25:28.251971: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1872] Adding visible gpu devices: 0\r\n2021-09-10 16:25:28.252321: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcudart.so.10.2\r\n2021-09-10 16:25:30.678805: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1258] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2021-09-10 16:25:30.679001: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1264]      0 \r\n2021-09-10 16:25:30.679108: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1277] 0:   N \r\n2021-09-10 16:25:30.679730: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1001] ARM64 does not support NUMA - returning NUMA node zero\r\n2021-09-10 16:25:30.680232: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1001] ARM64 does not support NUMA - returning NUMA node zero\r\n2021-09-10 16:25:30.680718: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1001] ARM64 does not support NUMA - returning NUMA node zero\r\n2021-09-10 16:25:30.680948: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1418] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 18146 MB memory) -> physical GPU (device: 0, name: Xavier, pci bus id: 0000:00:00.0, compute capability: 7.2)\r\n2021-09-10 16:25:30.837477: I tensorflow/core/platform/profile_utils/cpu_utils.cc:114] CPU Frequency: 31250000 Hz\r\n2021-09-10 16:25:32.770741: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcudnn.so.8\r\n2021-09-10 16:25:34.113545: E tensorflow/stream_executor/cuda/cuda_dnn.cc:373] Loaded runtime CuDNN library: 8.0.0 but source was compiled with: 8.2.1.  CuDNN library needs to have matching major version and equal or higher minor version. If using a binary install, upgrade your CuDNN library.  If building from sources, make sure the library loaded at runtime is compatible with the version specified during compile configuration.\r\n2021-09-10 16:25:34.122043: E tensorflow/stream_executor/cuda/cuda_dnn.cc:373] Loaded runtime CuDNN library: 8.0.0 but source was compiled with: 8.2.1.  CuDNN library needs to have matching major version and equal or higher minor version. If using a binary install, upgrade your CuDNN library.  If building from sources, make sure the library loaded at runtime is compatible with the version specified during compile configuration.\r\n2021-09-10 16:25:34.129232: E tensorflow/stream_executor/cuda/cuda_dnn.cc:373] Loaded runtime CuDNN library: 8.0.0 but source was compiled with: 8.2.1.  CuDNN library needs to have matching major version and equal or higher minor version. If using a binary install, upgrade your CuDNN library.  If building from sources, make sure the library loaded at runtime is compatible with the version specified during compile configuration.\r\n2021-09-10 16:25:34.131259: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Successfully opened dynamic library libcublas.so.10\r\n2021-09-10 16:25:35.282734: W tensorflow/core/framework/op_kernel.cc:1767] OP_REQUIRES failed at conv_ops.cc:1344 : Not found: No algorithm worked!\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py\", line 1375, in _do_call\r\n    return fn(*args)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py\", line 1360, in _run_fn\r\n    target_list, run_metadata)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py\", line 1453, in _call_tf_sessionrun\r\n    run_metadata)\r\ntensorflow.python.framework.errors_impl.UnknownError: 2 root error(s) found.\r\n  (0) Unknown: Failed to get convolution algorithm. This is probably because cuDNN failed to initialize, so try looking to see if a warning log message was printed above.\r\n\t [[{{node MobilenetV2/Conv/Conv2D}}]]\r\n\t [[ExpandDims_2/_19]]\r\n  (1) Unknown: Failed to get convolution algorithm. This is probably because cuDNN failed to initialize, so try looking to see if a warning log message was printed above.\r\n\t [[{{node MobilenetV2/Conv/Conv2D}}]]\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"./segmentation_node\", line 43, in <module>\r\n    semantic = model.infer([kr.imgmsg_to_cv2(on_image.last_image)])[0]\r\n  File \"/home/agx1/radar/src/ros-semantic-segmentation/semantic_segmentation/nodes/models/mnv2_bdd100k_driveable_513/__init__.py\", line 66, in infer\r\n    feed_dict = { INPUT_TENSOR_NAME: images }\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py\", line 968, in run\r\n    run_metadata_ptr)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py\", line 1191, in _run\r\n    feed_dict_tensor, options, run_metadata)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py\", line 1369, in _do_run\r\n    run_metadata)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/client/session.py\", line 1394, in _do_call\r\n    raise type(e)(node_def, op, message)\r\ntensorflow.python.framework.errors_impl.UnknownError: 2 root error(s) found.\r\n  (0) Unknown: Failed to get convolution algorithm. This is probably because cuDNN failed to initialize, so try looking to see if a warning log message was printed above.\r\n\t [[node MobilenetV2/Conv/Conv2D (defined at /home/agx1/radar/src/ros-semantic-segmentation/semantic_segmentation/nodes/models/mnv2_bdd100k_driveable_513/__init__.py:34) ]]\r\n\t [[ExpandDims_2/_19]]\r\n  (1) Unknown: Failed to get convolution algorithm. This is probably because cuDNN failed to initialize, so try looking to see if a warning log message was printed above.\r\n\t [[node MobilenetV2/Conv/Conv2D (defined at /home/agx1/radar/src/ros-semantic-segmentation/semantic_segmentation/nodes/models/mnv2_bdd100k_driveable_513/__init__.py:34) ]]\r\n0 successful operations.\r\n0 derived errors ignored.\r\n\r\nOriginal stack trace for 'MobilenetV2/Conv/Conv2D':\r\n  File \"./segmentation_node\", line 33, in <module>\r\n    model = getattr(__import__('models', globals(), locals(), fromlist = [MODEL]), MODEL).Model()\r\n  File \"/home/agx1/radar/src/ros-semantic-segmentation/semantic_segmentation/nodes/models/mnv2_bdd100k_driveable_513/__init__.py\", line 34, in __init__\r\n    tf.import_graph_def(self.graph_def, name='')\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/util/deprecation.py\", line 535, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/framework/importer.py\", line 405, in import_graph_def\r\n    producer_op_list=producer_op_list)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/framework/importer.py\", line 513, in _import_graph_def_internal\r\n    _ProcessNewOps(graph)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/framework/importer.py\", line 243, in _ProcessNewOps\r\n    for new_op in graph._add_new_tf_operations(compute_devices=False):  # pylint: disable=protected-access\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/framework/ops.py\", line 3709, in _add_new_tf_operations\r\n    for c_op in c_api_util.new_tf_operations(self)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/framework/ops.py\", line 3709, in <listcomp>\r\n    for c_op in c_api_util.new_tf_operations(self)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/framework/ops.py\", line 3590, in _create_op_from_tf_operation\r\n    ret = Operation(c_op, self)\r\n  File \"/usr/local/lib/python3.6/dist-packages/tensorflow/python/framework/ops.py\", line 2045, in __init__\r\n    self._traceback = tf_stack.extract_stack_for_node(self._c_op)\r\n\r\n", "comments": ["@BADAL244 ,\r\nIn order to expedite the trouble-shooting process, could you please provide the complete code, dataset and tensorflow version you are using to reproduce the issue reported here.Also please take a look at this [issue](https://github.com/tensorflow/tensorflow/issues/44072) with similar error.It helps.Thanks", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n"]}, {"number": 51928, "title": "C++ compile tensorflow r2.5", "body": "tensorflow_cc.dll.if.exp : error LNK2001: \u65e0\u6cd5\u89e3\u6790\u7684\u5916\u90e8\u7b26\u53f7 \"public: __cdecl tensorflow::TensorShapeBase<class tensorflow::TensorShape>::TensorShapeBase<class tensorflow::TensorShape>(class absl::lts_2020_02_25::Span<__int64 const >)\" (??0?$TensorShapeBase@VTensorShape@tensorflow@@@tensorflow@@QEAA@V?$Span@$$CB_J@lts_2020_02_25@absl@@@Z)\r\nbazel-out\\x64_windows-opt\\bin\\tensorflow\\tensorflow_cc.dll : fatal error LNK1120: 1 \u4e2a\u65e0\u6cd5\u89e3\u6790\u7684\u5916\u90e8\u547d\u4ee4\r\nTarget //tensorflow:tensorflow_cc.dll failed to build\r\nINFO: Elapsed time: 28.003s, Critical Path: 25.68s\r\nINFO: 4 processes: 2 internal, 2 local.\r\nFAILED: Build did NOT complete successfully\r\n", "comments": ["Hi @MisRight! We see that the issue template has not been filled, could you please do so as it helps us analyse the issue [tf version, steps followed before you ran into this error or stand alone code/colab gist to reproduce the issue faced].Thanks", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n"]}, {"number": 51927, "title": "Why can't you perform additional operations on the loss function under tf.gradienttape?", "body": "tf\uff1a2.2\r\nenv\uff1alinux\r\nthis is a **Triplet extraction model**\r\nsubject_labels is normal:   (batch_size,  max_len,  2)\r\nobject_labels is : (batch_size, max_len, len(predicate), 2)\r\nFor object_ Model I need to overwrite the padding part and only modify the text part\u3002\r\n\r\nHowever, after I perform the overwrite operation, although the obtained l**oss value** has no problem in the form, it is put into tf.gradienttape, and the weight value of Bert model cannot be obtained\r\n\r\nWhen my loss function is as follows\uff0cOnly TF related APIs are used:\r\n`\r\ndef loss4model(t, p, l, obj=False):\r\n    if obj:\r\n        loss_value = tf.keras.losses.binary_crossentropy(y_true=t, y_pred=p)\r\n        loss_value = tf.reduce_mean(loss_value, axis=2)\r\n    else:\r\n        loss_value = tf.keras.losses.binary_crossentropy(y_true=t, y_pred=p)\r\n\r\n    loss_value = tf.reduce_mean(loss_value)\r\n\r\n    return loss_value\r\n`\r\n\r\nWhen the model performs the following operations\uff08in the tf.GradientTape\uff09, it is normal and the loss function is normal\r\n![1631267664(1)](https://user-images.githubusercontent.com/34124260/132836145-3ab467d2-e009-467d-9d9e-ce0570f06b47.png)\r\nlike this\uff1a\r\n![1631268153(1)](https://user-images.githubusercontent.com/34124260/132837171-dcf8277e-f279-4ca1-ad41-32ffe796ad03.png)\r\n\r\nBut when I need to do some additional operations on the loss function, for example\r\n`\r\ndef loss4model(t, p, l, obj=False):\r\n    \"\"\"I need to overwrite the padding part and only lose the text par\r\n    \"\"\"\r\n    if obj:\r\n        loss_value = tf.keras.losses.binary_crossentropy(y_true=t, y_pred=p)\r\n        loss_value = tf.reduce_mean(loss_value, axis=2)\r\n    else:\r\n        loss_value = tf.keras.losses.binary_crossentropy(y_true=t, y_pred=p)\r\n        \r\n    loss_values = []\r\n    for num, weights in enumerate(loss_value):\r\n       # Get the loss value within the specified range through the length of TF. Gather() and len(text)\r\n        indices = np.arange(l[num])\r\n        loss = tf.gather(weights, indices)\r\n        loss = tf.reduce_mean(loss)\r\n        loss_values.append(loss.numpy())\r\n\r\n    loss_value = tf.reduce_mean(tf.constant(loss_values))\r\n\r\n    return loss_value\r\n`\r\n![1631267758(1)](https://user-images.githubusercontent.com/34124260/132836279-2dcc5c49-85d4-4f5e-af6c-88cf6ad8dd28.png)\r\n\r\nYou can see that the **loss value is a normal tensor**, but I **can't get the weight value** of the model as above\uff0cthe weight is None\uff1a\r\n![1631267805(1)](https://user-images.githubusercontent.com/34124260/132836401-95a9f696-49a8-4f02-9866-3c2b2b3bb27e.png)\r\n\r\n\r\nI tried to define a loss directly in the model llike this\r\n![1631268227(1)](https://user-images.githubusercontent.com/34124260/132837321-8134abbc-5b26-4520-aad0-a0604ab703c1.png)\r\nit cant help\r\n![1631268249(1)](https://user-images.githubusercontent.com/34124260/132837364-1dca5332-3abb-4ad5-90bf-de9f7ad79aba.png)\r\n\r\nso, i want to know, loss_value is just a tf.tensor, Why can it affect the weight update and acquisition of the model?\r\nand How can I still make loss work after I operate it?\r\n", "comments": ["@1148330040 \r\nCan you please fill the issue [template](https://github.com/tensorflow/tensorflow/issues/new/choose),In order to expedite the trouble-shooting process, please provide a code snippet to reproduce the issue reported here. Thanks!", "> @1148330040\r\n> Can you please fill the issue [template](https://github.com/tensorflow/tensorflow/issues/new/choose),In order to expedite the trouble-shooting process, please provide a code snippet to reproduce the issue reported here. Thanks!\r\n\r\ncode  It's a little long, so I'll describe it as much as possible. I'd like to ask you", "@1148330040 It looks like you are using an older Version of Tensorflow (2.2). Many bugs have been fixed in the latest version. Can you please execute your code using Latest Version (2.6.0) and let us know if the issue still persists? Please have a look at the[ link](https://www.tensorflow.org/api_docs/python/tf/GradientTape) & let us know if it helps? Thanks!", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51927\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51927\">No</a>\n"]}, {"number": 51926, "title": "ImportError: DLL load failed while importing _pywrap_tensorflow_internal: A dynamic link library (DLL) initialization routine failed.", "body": "Hello,\r\nI ran this comand in Conda:\r\n\r\n(style-transfer) E:\\Python\\fast-style-transfer>python evaluate.py --checkpoint ./rain-princess.ckpt --in-path <E:\\Python\\fast-style-transfer\\arnius_gali.jpg> --out-path ./arnius_gali2.jpg\r\n\r\nGot this error message:\r\n\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\User\\anaconda3\\envs\\style-transfer\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 64, in <module>\r\n    from tensorflow.python._pywrap_tensorflow_internal import *\r\nImportError: DLL load failed while importing _pywrap_tensorflow_internal: A dynamic link library (DLL) initialization routine failed.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"E:\\Python\\fast-style-transfer\\evaluate.py\", line 4, in <module>\r\n    import transform, numpy as np, vgg, pdb, os\r\n  File \"E:\\Python\\fast-style-transfer\\src\\transform.py\", line 1, in <module>\r\n    import tensorflow as tf, pdb\r\n  File \"C:\\Users\\User\\anaconda3\\envs\\style-transfer\\lib\\site-packages\\tensorflow\\__init__.py\", line 41, in <module>\r\n    from tensorflow.python.tools import module_util as _module_util\r\n  File \"C:\\Users\\User\\anaconda3\\envs\\style-transfer\\lib\\site-packages\\tensorflow\\python\\__init__.py\", line 40, in <module>\r\n    from tensorflow.python.eager import context\r\n  File \"C:\\Users\\User\\anaconda3\\envs\\style-transfer\\lib\\site-packages\\tensorflow\\python\\eager\\context.py\", line 35, in <module>\r\n    from tensorflow.python import pywrap_tfe\r\n  File \"C:\\Users\\User\\anaconda3\\envs\\style-transfer\\lib\\site-packages\\tensorflow\\python\\pywrap_tfe.py\", line 28, in <module>\r\n    from tensorflow.python import pywrap_tensorflow\r\n  File \"C:\\Users\\User\\anaconda3\\envs\\style-transfer\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 83, in <module>\r\n    raise ImportError(msg)\r\nImportError: Traceback (most recent call last):\r\n  File \"C:\\Users\\User\\anaconda3\\envs\\style-transfer\\lib\\site-packages\\tensorflow\\python\\pywrap_tensorflow.py\", line 64, in <module>\r\n    from tensorflow.python._pywrap_tensorflow_internal import *\r\nImportError: DLL load failed while importing _pywrap_tensorflow_internal: A dynamic link library (DLL) initialization routine failed.\r\n\r\n\r\nFailed to load the native TensorFlow runtime.\r\n\r\nHow can I find out what I did wrong and how to fix it?\r\n\r\nThank you", "comments": ["@ArniusOm ,\r\nCan you please take a look at this [comment](https://github.com/tensorflow/tensorflow/issues/36167#issuecomment-577886156) from the issue with similar error.It helps.Also in order to expedite the trouble-shooting process, could you please provide the following information\r\nOS Platform and Distribution (e.g., Linux Ubuntu 16.04):\r\nMobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\r\nTensorFlow installed from (source or binary):\r\nTensorFlow version:\r\nPython version:\r\nInstalled using virtualenv? pip? conda?:\r\nBazel version (if compiling from source):\r\nGCC/Compiler version (if compiling from source):\r\nCUDA/cuDNN version:\r\nGPU model and memory:\r\n \r\nand the exact sequence of commands / steps that you executed before running into the problem.Thanks\r\n", "Hey Tilakrayal, thanks for taking your time.\r\n\r\nHere are my specifications:\r\n\r\nWindows 10 Pro\r\nTensor Flow was installed vs most recent Anacoda version\r\nTensor flow 2.5.0\r\nPython 3.9.6\r\nInstalled using Conda\r\nCudatoolkit 11.0.221\r\nCudnn 8.2.1\r\nGpu NVIDIA GeForce GT 1030\r\n2,048 MB GDDR5\r\n\r\nRegarding what I ran:\r\n\r\nThis was the command that I ran:\r\n\r\npython evaluate.py --checkpoint ./rain-princess.ckpt --in-path <E:\\Python\\fast-style-transfer\\arnius_gali.jpg> --out-path ./arnius_gali2.jpg\r\n\r\nWould appreciate if you could give me some guidance on what to do at this point.\r\n\r\nThank you\r\n\r\n", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51926\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51926\">No</a>\n", "Glad the suggested above [comment](https://github.com/tensorflow/tensorflow/issues/51926#issuecomment-917066836) worked for you to resolve the issue.Thanks!"]}, {"number": 51924, "title": "Remove nanopb's remaining files", "body": "This PR removes nanopb's remaining files and references as nanopb\r\nhas been removed from tensorflow in 43adb4ee3b96e250e05533bc2470813c2f70272c\r\n\r\nSigned-off-by: Yong Tang <yong.tang.github@outlook.com>", "comments": []}, {"number": 51923, "title": "Update grpc to v1.40.0", "body": "This PR updates grpc to v1.40.0\r\n\r\nSigned-off-by: Yong Tang <yong.tang.github@outlook.com>", "comments": ["There may still be some hidden tests that may fail.  Though it can be a start. Still need to see if internal tests work or not.\r\n\r\nAlso not sure about protobuf version in python. In setup.py, 'protobuf >= 3.9.2' has been specified, though it likely requires much later version. Will update if needed.\r\n\r\nSome windows tests are failing, e.g.,\r\n```\r\n//py_test_dir/tensorflow/python/framework:convert_to_constants_test \r\n```\r\nI couldn't see if they are related or not (may be related).\r\n\r\n@satishpasumarthi you can apply the patch to your PR #44282 if you prefer. I can close this PR after that.", "I think protobuf and grpc need to be updated in sync. But let's try this way first.", "@mihaimaruseac Grpc added a patched version of the protobuffer, I think that might reduce the need to maintain on tensorflow core:\r\n\r\nhttps://github.com/grpc/grpc/blob/master/bazel/grpc_deps.bzl#L212-L223\r\n\r\nWe can leave protobuffer alone in tensorflow repo. It will override grpc's binding. Though we will need to maintain the patch separately and update protobuffer to a compatible version with grpc.", "Oh, let's go with this one then.", "> There may still be some hidden tests that may fail. Though it can be a start. Still need to see if internal tests work or not.\r\n> \r\n> Also not sure about protobuf version in python. In setup.py, 'protobuf >= 3.9.2' has been specified, though it likely requires much later version. Will update if needed.\r\n> \r\n> Some windows tests are failing, e.g.,\r\n> \r\n> ```\r\n> //py_test_dir/tensorflow/python/framework:convert_to_constants_test \r\n> ```\r\n> \r\n> I couldn't see if they are related or not (may be related).\r\n> \r\n> @satishpasumarthi you can apply the patch to your PR #44282 if you prefer. I can close this PR after that.\r\n\r\nAre we going with this PR or https://github.com/tensorflow/tensorflow/pull/44282 ?", "I'm ok with either", "This is causing the several tests on Windows to fail with the cryptic error: `Windows fatal exception: code 0xc0000374`.\r\n\r\nThis can be reproduced by running the following in the command prompt in the Tensorflow directory at commit ea3807f1c52984c991e3b832ad462b62c0563a1c:\r\n\r\n```bat\r\nconfigure\r\nset TF2_BEHAVIOR=1\r\nbazel build --announce_rc --config=opt //tensorflow/python/kernel_tests:summary_ops_test && bazel-bin\\tensorflow\\python\\kernel_tests\\summary_ops_test.exe SummaryOpsTest.testTrace_withProfiler\r\n```\r\n\r\nI plan on rolling this change back soon. Unfortunately, I am unsure what is causing this issue. The output of the test is:\r\n\r\n```\r\n[ RUN      ] SummaryOpsTest.testTrace_withProfiler\r\n2021-09-14 19:28:16.764405: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2\r\nTo enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\r\nWARNING:tensorflow:From \\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\ops\\summary_ops_v2.py:1305: start (from tensorflow.python.eager.profiler) is deprecated and will be removed after 2020-07-01.\r\nInstructions for updating:\r\nuse `tf.profiler.experimental.start` instead.\r\nW0914 19:28:16.815090 17452 deprecation.py:341] From \\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\ops\\summary_ops_v2.py:1305: start (from tensorflow.python.eager.profiler) is deprecated and will be removed after 2020-07-01.\r\nInstructions for updating:\r\nuse `tf.profiler.experimental.start` instead.\r\n2021-09-14 19:28:16.825582: I tensorflow/core/profiler/lib/profiler_session.cc:110] Profiler session initializing.\r\n2021-09-14 19:28:16.829039: I tensorflow/core/profiler/lib/profiler_session.cc:125] Profiler session started.\r\nWARNING:tensorflow:From \\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\ops\\summary_ops_v2.py:1355: stop (from tensorflow.python.eager.profiler) is deprecated and will be removed after 2020-07-01.\r\nInstructions for updating:\r\nuse `tf.profiler.experimental.stop` instead.\r\nW0914 19:28:16.940137 17452 deprecation.py:341] From \\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\ops\\summary_ops_v2.py:1355: stop (from tensorflow.python.eager.profiler) is deprecated and will be removed after 2020-07-01.\r\nInstructions for updating:\r\nuse `tf.profiler.experimental.stop` instead.\r\n2021-09-14 19:28:16.947135: I tensorflow/core/profiler/lib/profiler_session.cc:67] Profiler session collecting data.\r\n2021-09-14 19:28:16.952225: I tensorflow/core/profiler/lib/profiler_session.cc:143] Profiler session tear down.\r\nWindows fatal exception: code 0xc0000374\r\n\r\nCurrent thread 0x0000442c (most recent call first):\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\eager\\profiler.py\", line 108 in stop\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\util\\deprecation.py\", line 348 in new_func\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\ops\\summary_ops_v2.py\", line 1355 in trace_export\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\kernel_tests\\summary_ops_test.py\", line 1497 in testTrace_withProfiler\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\framework\\test_util.py\", line 1476 in decorated\r\n  File \"C:\\Python39\\lib\\unittest\\case.py\", line 550 in _callTestMethod\r\n  File \"C:\\Python39\\lib\\unittest\\case.py\", line 593 in run\r\n  File \"C:\\Python39\\lib\\unittest\\case.py\", line 653 in __call__\r\n  File \"C:\\Python39\\lib\\unittest\\suite.py\", line 122 in run\r\n  File \"C:\\Python39\\lib\\unittest\\suite.py\", line 84 in __call__\r\n  File \"C:\\Python39\\lib\\unittest\\suite.py\", line 122 in run\r\n  File \"C:\\Python39\\lib\\unittest\\suite.py\", line 84 in __call__\r\n  File \"C:\\Python39\\lib\\unittest\\runner.py\", line 176 in run\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\absl_py\\absl\\testing\\_pretty_print_reporter.py\", line 87 in run\r\n  File \"C:\\Python39\\lib\\unittest\\main.py\", line 271 in runTests\r\n  File \"C:\\Python39\\lib\\unittest\\main.py\", line 101 in __init__\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\absl_py\\absl\\testing\\absltest.py\", line 2401 in _run_and_get_tests_result\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\absl_py\\absl\\testing\\absltest.py\", line 2430 in run_tests\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\absl_py\\absl\\testing\\absltest.py\", line 2106 in _run_in_app\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\absl_py\\absl\\testing\\absltest.py\", line 1999 in main\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\platform\\googletest.py\", line 55 in g_main\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\absl_py\\absl\\app.py\", line 251 in _run_main\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\absl_py\\absl\\app.py\", line 300 in run\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\platform\\googletest.py\", line 64 in main_wrapper\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\platform\\benchmark.py\", line 518 in benchmarks_main\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\platform\\googletest.py\", line 66 in main\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\platform\\test.py\", line 60 in main\r\n  File \"\\\\?\\C:\\Users\\kbuilder\\AppData\\Local\\Temp\\Bazel.runfiles_w37ihgl_\\runfiles\\org_tensorflow\\tensorflow\\python\\kernel_tests\\summary_ops_test.py\", line 1625 in <module>\r\n```", "`0xc0000374` is `STATUS_HEAP_CORRUPTION` which usually means apps writing on to a released memory. "]}, {"number": 51922, "title": "Sub-classed constraint doesn't appear to be called", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): A proprietary variant of RedHat, outside of my control\r\n- TensorFlow installed from (source or binary): Binary\r\n- TensorFlow version (use command below): 2.5.0\r\n- Python version: 3.7.2\r\n- CUDA/cuDNN version: 11.1.0/8.1.1\r\n- GPU model and memory: Nvidia K40 12GB\r\n\r\n**Describe the current behavior**\r\nI have created a sub-classed layer that performs a weighted sum of the outputs of two sub_models.\r\nIn this layer, I create weights with the `add_weight` function which includes the use of a constraint.\r\n\r\nThe intention of the constraint is to normalize the weights of each input dimension/feature (i.e. sum to one).\r\n\r\nI have created a custom weight normalization constraint which is sub-classed from `krs.constraints.Constraint`. The output weights from the constraint function for model consisting of 2 sub-models with each producing a 200 dimension/feature output. Thus, the input to the constraint would be 2 x 200 weight tensor and the columnwise sums should all be 1.0.\r\n\r\nWhen providing an instance of my constraint class to the `add_weight` function, it appears that there it is never called. It is initialized though. When running `VectorWeightedSum_1` below the `tf.print` statement in the call function shows that the weights are never normalized. Also, the `tf.print` statement in `NormalizeSumWeights.call()` doesn't ever produce an output. (It also doesn't exit the program if I put a `sys.exit()` call inside the contraint's `call`)\r\n\r\nIf I instead use `VectorWeightedSum_2`, the `tf.print` statement demonstrates that weights are indeed normalized properly. This was done by creating a new function inside the `VectorWeightedSum_2` class as opposed to a constraint class. The line for this code is commented out in the code below.\r\n\r\n**Describe the expected behavior**\r\nThe sub-classed constraint should have it's `call` function called.\r\n\r\nThe weights produced by the sub-classed constraint should sum to 1.0 along each column.\r\n\r\nIn the example code, the `tf.print` statements should be printed for both `_constraint` and the use of the `NormalizeSumWeights` class.\r\n\r\n**[Contributing](https://www.tensorflow.org/community/contribute)**\r\n\r\n- Do you want to contribute a PR? (yes/no): No\r\n\r\n**Standalone code to reproduce the issue**\r\n```\r\nimport numpy as np\r\nimport tensorflow as tf\r\nimport tensorflow.keras as krs\r\n\r\nclass NormalizeSumWeights(krs.constraints.Constraint):\r\n    def __init__(self,**kwargs):\r\n        super(NormalizeSumWeights,self).__init__(**kwargs)\r\n\r\n    def call(self,w):\r\n        tf.print(\"NormalizeSumWeights_________________________________\")\r\n        return tf.math.divide(w,tf.math.reduce_sum(w,axis=0))\r\n\r\nclass WeightedSum(krs.layers.Layer):\r\n    def __init__( self, n_models = 2, **kwargs):\r\n        super( WeightedSum, self ).__init__( **kwargs)\r\n        self.n_models = n_models\r\n\r\n    def build(self,input_shape):\r\n        self.sum_weights = self.add_weight(name=\"sum_weights\",shape=(self.n_models,1),\r\n                                    initializer = krs.initializers.RandomUniform(0,1.0),\r\n                                    constraint = NormalizeSumWeights(),\r\n                                    trainable = True)\r\n\r\n    def call(self,inputs):\r\n        output = tf.multiply(tf.cast(self.sum_weights[0,:],inputs[0].dtype),inputs[0])\r\n        for i in range(1,len(inputs)):\r\n            output += tf.multiply(inputs[i],tf.cast(self.sum_weights[i,0],inputs[0].dtype))\r\n\r\n        return output\r\n\r\n    def get_config(self):\r\n        data = { \"n_models\": self.n_models}\r\n        return data\r\n\r\nclass VectorWeightedSum_1(krs.layers.Layer):\r\n    def __init__( self, n_models = 2,n_dimensions=200, **kwargs):\r\n        super( VectorWeightedSum_1, self ).__init__( **kwargs)\r\n        self.n_models = n_models\r\n        self.n_dimensions = n_dimensions\r\n\r\n    def build(self,input_shape):\r\n        self.sum_weights = self.add_weight(name=\"sum_weights\",shape=(self.n_models,self.n_dimensions),\r\n                                    initializer = krs.initializers.RandomUniform(0,1.0),\r\n                                    constraint = NormalizeSumWeights(),\r\n                                    trainable = True)\r\n    def _constraint(self,w):\r\n        tf.print(\"Weights Normalization__________________________\")\r\n        return tf.math.divide(w,tf.math.reduce_sum(w,axis=0))\r\n\r\n    def call(self,inputs):\r\n        output = tf.multiply(tf.cast(self.sum_weights[0,:],inputs[0].dtype),inputs[0])\r\n\r\n        for i in range(1,len(inputs)):\r\n            output += tf.multiply(inputs[i],tf.cast(self.sum_weights[i,:],inputs[0].dtype))\r\n        tf.print(\"vectorWeightedSum___weights________________\")\r\n        tf.print(self.sum_weights)\r\n\r\n        return output\r\n\r\nclass VectorWeightedSum_2(krs.layers.Layer):\r\n    def __init__( self, n_models = 2,n_dimensions=200, **kwargs):\r\n        super( VectorWeightedSum_2, self ).__init__( **kwargs)\r\n        self.n_models = n_models\r\n        self.n_dimensions = n_dimensions\r\n\r\n    def build(self,input_shape):\r\n        self.sum_weights = self.add_weight(name=\"sum_weights\",shape=(self.n_models,self.n_dimensions),\r\n                                    initializer = krs.initializers.RandomUniform(0,1.0),\r\n                                    constraint = self._constraint,\r\n                                    trainable = True)\r\n    def _constraint(self,w):\r\n        tf.print(\"Weights Normalization__________________________\")\r\n        return tf.math.divide(w,tf.math.reduce_sum(w,axis=0))\r\n\r\n    def call(self,inputs):\r\n\r\n        output = tf.multiply(tf.cast(self.sum_weights[0,:],inputs[0].dtype),inputs[0])\r\n\r\n        for i in range(1,len(inputs)):\r\n            output += tf.multiply(inputs[i],tf.cast(self.sum_weights[i,:],inputs[0].dtype))\r\n        tf.print(\"vectorWeightedSum___weights________________\")\r\n        tf.print(self.sum_weights)\r\n\r\n        return output\r\n\r\ninput_lf = krs.Input((4,))\r\n\r\nx = input_lf\r\nx = krs.layers.Dense(10,activation = 'relu')(x)\r\nx = krs.layers.Dense(10,activation = 'relu')(x)\r\nlf_out = krs.layers.Dense(200,activation = 'relu')(x)\r\n\r\nlf_mod = krs.Model(input_lf,lf_out,name='lf')\r\n\r\ninput_hf_lin = krs.Input((204,))\r\nx = input_hf_lin\r\nx = krs.layers.Dense(10)(x)\r\nx = krs.layers.Dense(10)(x)\r\nhf_lin_out = krs.layers.Dense(200,activation = 'relu')(x)\r\n\r\nhf_lin_mod = krs.Model(input_hf_lin,hf_lin_out,name='hf_linear')\r\n\r\ninput_hf_nonlin = krs.Input((14,))\r\n\r\nx = input_hf_nonlin\r\nx = krs.layers.Dense(10,activation = 'relu')(x)\r\nx = krs.layers.Dense(10,activation = 'relu')(x)\r\nhf_nonlin_out = krs.layers.Dense(200,activation = 'relu')(x)\r\n\r\nhf_nonlin_mod = krs.Model(input_hf_lin,hf_lin_out,name='hf_nonlinear')\r\n\r\ninput_hf = krs.Input((204,))\r\n\r\nx = input_hf\r\nlin = hf_lin_mod(x)\r\nnonlin = hf_nonlin_mod(x)\r\nsummed_out = VectorWeightedSum_1(n_models=2)([lin,nonlin])\r\n#summed_out = VectorWeightedSum_2(n_models=2)([lin,nonlin])\r\n\r\nhf_mod = krs.Model(input_hf,summed_out,name='hf')\r\n\r\ninput_full_mod = krs.Input((4,))\r\nx = input_full_mod\r\n\r\nlow = lf_mod(x)\r\nx = krs.layers.Concatenate()([low,x])\r\nfull_out = hf_mod(x)\r\n\r\nfull_mod = krs.Model(input_full_mod,outputs = {'low_fidelity':low,'high_fidelity':full_out},name='full_model')\r\n\r\nopt = krs.optimizers.Adam()\r\nloss = krs.losses.MSE\r\nfull_mod.compile(optimizer = opt,loss = loss)\r\n\r\nx_train = np.random.uniform(0,10,(20,4))\r\ny_train_low = np.random.uniform(0,10,(20,200))\r\ny_train_high = np.random.uniform(0,10,(20,200))\r\ny = {\"low_fidelity\": y_train_low,\r\n     \"high_fidelity\": y_train_high}\r\n\r\nfull_mod.fit(x_train,y,epochs=5,batch_size=1)\r\n```\r\n", "comments": ["@EnderWiggin14 \r\nPlease post this issue on [keras-team/keras repo.](https://github.com/keras-team/keras/issues)\r\nTo know more see;\r\n[https://discuss.tensorflow.org/t/keras-project-moved-to-new-repository-in-https-github-com-keras-team-keras/1999](https://discuss.tensorflow.org/t/keras-project-moved-to-new-repository-in-https-github-com-keras-team-keras/1999)\r\nThank you!", "Bug issue moved [here](https://github.com/keras-team/keras/issues/15345).", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51922\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51922\">No</a>\n"]}, {"number": 51921, "title": "How can I the outputs of tf_logging  on a TestCase", "body": "I write a `test.TestCase` file, and i could't find the outputs of tf_logging.\r\n\r\ncode:\r\n```\r\nfrom tensorflow.python.platform import tf_logging\r\nimport logging\r\nimport sys\r\ntf_logging.set_verbosity(tf_logging.INFO)\r\nlogger = logging.getLogger(\"tensorflow\")\r\nif len(logger.handlers) == 1:\r\n  logger.handlers = []\r\n  logger.setLevel(logging.INFO)\r\n  formatter = logging.Formatter(\r\n      \"%(asctime)s - [%(filename)s:%(lineno)d] - %(name)s - %(levelname)s - %(message)s\")\r\n  ch = logging.StreamHandler(sys.stdout)\r\n  ch.setLevel(logging.INFO)\r\n  ch.setFormatter(formatter)\r\n  logger.addHandler(ch)\r\n\r\nclass PipelineTest(test.TestCase):\r\n  def __init__(self, method_name=\"runTest\"):\r\n    super(PipelineTest, self).__init__(method_name)\r\n\r\n  def testBuild(self):\r\n      tf_logging.info(\"Output\")\r\n```\r\n\r\ncompile command:\r\n`\r\nbazel test --test_arg=--v=3 --test_output=streamed //tensorflow/python:pipeline_embedding_ops_test\r\n`\r\nBut I couldn't find the output of \"logging.info(\"Output\")\".\r\n\r\nthrow a error : No handlers could be found for logger \"tensorflow\"", "comments": ["@wu-yy ,\r\nCan you please let us know the tensorflow version you are trying to execute the code.It helps in analysing the issue.Thanks", "@tilakrayal ,  hi, the tensorflow version is `r1.15`.", "@wu-yy ,\r\nWe see that you are using tf version 1.15, 1.x is not actively supported, please update to latest stable version v2.5 or v2.6 and let us know if you are using same issue.", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n"]}, {"number": 51920, "title": "[determinism] Add d9m-unimplemented exception for tf.nn.depthwise_conv2d", "body": "This current PR adds and tests determinism-unimplemented exception-throwing for `tf.nn.depthwise_conv2d` when determinism is expected but not available. It also tests that the op functions deterministically when determinism is expected and is available (forward/backward CPU and forward/backward GPU using cuDNN).\r\n\r\nThis PR is related to [RFC: Enabling Determinism in TensorFlow](https://github.com/tensorflow/community/blob/master/rfcs/20210119-determinism.md). For status and history of GPU-determinism for this op, see [here](https://github.com/NVIDIA/framework-determinism/blob/master/tensorflow_status.md#depthwise-convolution).\r\n\r\nI believe that when this op uses cuDNN convolution functionality, it benefits from all the determinism solutions associated with that, including deterministic algorithm selection (assuming that still works).\r\n\r\nCC @reedwm, @sanjoy, @nluehr", "comments": []}, {"number": 51919, "title": "[ROCm]  Update to use ROCm 4.3.1 (when building TF with --config=rocm)", "body": "/cc @cheshire @chsigg ", "comments": ["@gbaned gentle ping. this PR seems to have gotten stuck in merge pipeline"]}, {"number": 51918, "title": "Prevent crashes when loading tensor slices with unsupported types.", "body": "Also fix the `Tensor(const TensorShape&)` constructor swapping the LOG(FATAL)\r\nmessages for the unset and unsupported types.\r\n\r\nPiperOrigin-RevId: 392695027\r\nChange-Id: I4beda7db950db951d273e3259a7c8534ece49354\r\n(cherry picked from commit abcced051cb1bd8fb05046ac3b6023a7ebcc4578)", "comments": ["\nThanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).\n\n:memo: **Please visit <https://cla.developers.google.com/> to sign.**\n\nOnce you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.\n\n----\n\n#### What to do if you already signed the CLA\n\n##### Individual signers\n\n*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n\n##### Corporate signers\n\n*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).\n*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).\n\t\t\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51918) for more info**.\n\n<!-- need_sender_cla -->", "@pranve Can you please sign CLA. Thanks!", "@googlebot I signed it!"]}, {"number": 51917, "title": "Prevent crashes when loading tensor slices with unsupported types.", "body": "Also fix the `Tensor(const TensorShape&)` constructor swapping the LOG(FATAL)\r\nmessages for the unset and unsupported types.\r\n\r\nPiperOrigin-RevId: 392695027\r\nChange-Id: I4beda7db950db951d273e3259a7c8534ece49354\r\n(cherry picked from commit abcced051cb1bd8fb05046ac3b6023a7ebcc4578)", "comments": ["\nThanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).\n\n:memo: **Please visit <https://cla.developers.google.com/> to sign.**\n\nOnce you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.\n\n----\n\n#### What to do if you already signed the CLA\n\n##### Individual signers\n\n*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n\n##### Corporate signers\n\n*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).\n*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).\n\t\t\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51917) for more info**.\n\n<!-- need_sender_cla -->", "@pranve Can you please sign CLA. Thanks!", "@googlebot I signed it!"]}, {"number": 51916, "title": "Prevent crashes when loading tensor slices with unsupported types.", "body": "Also fix the `Tensor(const TensorShape&)` constructor swapping the LOG(FATAL)\r\nmessages for the unset and unsupported types.\r\n\r\nPiperOrigin-RevId: 392695027\r\nChange-Id: I4beda7db950db951d273e3259a7c8534ece49354", "comments": ["\nThanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).\n\n:memo: **Please visit <https://cla.developers.google.com/> to sign.**\n\nOnce you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.\n\n----\n\n#### What to do if you already signed the CLA\n\n##### Individual signers\n\n*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n\n##### Corporate signers\n\n*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).\n*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).\n*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).\n\t\t\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51916) for more info**.\n\n<!-- need_sender_cla -->", "@pranve Can you please sign CLA. Thanks!", "@googlebot I signed it!"]}, {"number": 51915, "title": "ModuleNotFoundError: No module named 'tensorflow.python.eager'", "body": "\r\n\r\n**System information**\r\n-  I wrote a custom code\r\n- Windows 10\r\n- TensorFlow installed from source\r\n- TensorFlow version : 2.6.0\r\n- Python version:3.9\r\n\r\n\r\n**Describe the current behavior**\r\n\r\nWhen i run the code, the following error appears :\r\nfrom tensorflow.python.eager import context\r\nModuleNotFoundError: No module named 'tensorflow.python.eager'\r\n\r\n**Describe the expected behavior**\r\n\r\nThis error shouldn't happen. The tensorflow was correct installed. I also tried to re-install it, and the same error continue.\r\n\r\n\r\n**Standalone code to reproduce the issue**\r\nThis is a load error, i cant run any tensorflow code.\r\n\r\n**Other info / logs** \r\n  from tensorflow.python.eager import context\r\nModuleNotFoundError: No module named 'tensorflow.python.eager'\r\n", "comments": ["Hi @rfmeloneto ! Did you verify with instructions here for building from [source](https://www.tensorflow.org/install/source_windows). Can you please try again with Python 3.6/3.8? I was not able to replicate this issue in  Colab though.", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51915\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51915\">No</a>\n"]}, {"number": 51914, "title": "Update Dockerfiles to Ubuntu 20.04", "body": "This seemed to mostly work locally, so I'm making this change to see if\nour automation will pick it up and succeed. This also updates the\ncontainer Python version to one newer than 3.6 and the CUDA version to\n11.2.\n\nOne notable new requirement is that users must run ldconfig after the\nimage starts to pick up libraries that are mounted by nvidia-docker. If\nthe automation is successful, then I'll look into updating the Docker\nHub page.\n\nWorking with this system is getting to be quite the hassle, so I'm glad\nto be able to drop it in the future.", "comments": ["FYI @bhack ", "I had some extra commit at the old https://github.com/tensorflow/tensorflow/pull/48371 but I suppose that they are for the next `tensorflow:devel` generation. \r\nIf the \"next-gen\" will be too far in the future I suggest to recover at least `clang-format` and `pylint` availability in the devel images.", "P.s. also in my PR there was a diff in https://github.com/bhack/tensorflow/blob/master/tensorflow/tools/dockerfiles/spec.yml.\r\n\r\nWhy we don't see any diffs on this file here?", "> I had some extra commit at the old #48371 but I suppose that they are for the next tensorflow:devel generation.\r\nIf the \"next-gen\" will be too far in the future I suggest to recover at least clang-format and pylint availability in the devel images.\r\n\r\nGood idea, I added clang-format but not pylint since it can be installed quickly to match the GitHub Action.\r\n\r\n> P.s. also in my PR there was a diff in https://github.com/bhack/tensorflow/blob/master/tensorflow/tools/dockerfiles/spec.yml. Why we don't see any diffs on this file here?\r\n\r\nI didn't include the precommit stuff from your PR (which is one reason why I split this into a new one), which is one part of the `spec.yml` changes, and I changed the `UBUNTU_VERSION` variable in-place, which covers both of the changes to `spec.yml`.", "> but not pylint since it can be installed quickly to match the GitHub Action.\r\n\r\nI think that this is an expectation with a very low probability. I don't think that contributors will care to install the right `pylint` version that match the Github Action. Who is going by default to check the Github Action log details or source code?\r\nIt is why some month ago [I've requested to run the linting action with exactly the same `tesnorflow:devel` image](https://github.com/tensorflow/tensorflow/pull/50133#issuecomment-856329703) so that we was exactly on the same page, locally and GithubAction, with a very little effort.\r\n\r\n>  I changed the UBUNTU_VERSION variable in-place, which covers both of the changes to spec.yml\r\n\r\nBut do you have still used the scripts to generate this PR/diff or with the in-place change you have manually edited all the Dockerfiles?  ", "Thanks"]}, {"number": 51912, "title": "[XLA:GPU] Use arg_num instead of kernel parameter to check resource_updates", "body": "Separate some codes into this PR for cleanness from [a previous PR](https://github.com/tensorflow/tensorflow/pull/51353). \r\n\r\nIt turns out this is a bug that can cause buffer_donation (in resource var update) to not work as expected in manual clustering (in addition to auto-clustering). The added test `testUpdateVariableWithCompileTimeConstMemoryUsage` fails without the fix to use `arg_num` (instead of kernel parameters) to check whether a parameter is a resource update or not.\r\n", "comments": ["@cheshire could you help to take a look at this? Thanks!", "Looks like we need to skip the gpu_mlir_bridge_test for the newly added test?\r\n\r\nhttps://source.cloud.google.com/results/invocations/1ee388e8-2c51-4ec3-8b7c-ad10e62b092a/targets/%2F%2Ftensorflow%2Fpython%2Feager:def_function_xla_jit_test_gpu_mlir_bridge_test/tests", "> Looks like we need to skip the gpu_mlir_bridge_test for the newly added test?\r\n> \r\n> https://source.cloud.google.com/results/invocations/1ee388e8-2c51-4ec3-8b7c-ad10e62b092a/targets/%2F%2Ftensorflow%2Fpython%2Feager:def_function_xla_jit_test_gpu_mlir_bridge_test/tests\r\n\r\nSkip the newly added test for MLIR. @cheshire could you help to launch the CI again? Thanks!"]}, {"number": 51911, "title": "TensorFlow throws an exception when loading a model that was normalized like this.", "body": "See my stackoverflow question that covers up everything:\r\nhttps://stackoverflow.com/questions/69112466/why-tensorflow-throws-this-exception-when-loading-a-model-that-was-normalized-li", "comments": ["In addition to that, using that same code example from stackoverflow will notice a significant loss of accuracy after the model is loaded properly (with input_dim specified in Normalization()), however that does NOT happen in tensorflow-gpu 2.5.0 which means tensorflow-gpu 2.6.0 has more bugs than expected.", "@rafak360 ,\r\nI was able to execute the mentioned [SO code](https://stackoverflow.com/questions/69112466/why-tensorflow-throws-this-exception-when-loading-a-model-that-was-normalized-li) in tf v2.6 without any issue.Please find the gist of it [here](https://colab.research.google.com/gist/tilakrayal/845d0574f6411100fc00255bfcfc0b62/un51911.ipynb).Also i can see your  tf v2.6 is installed with Cuda 11.4.2 which is incompatible.Please check the link for tested build [configurations](https://www.tensorflow.org/install/source#gpu) and try to install with compatible version.Thanks!", "> @rafak360 ,\n> I was able to execute the mentioned [SO code](https://stackoverflow.com/questions/69112466/why-tensorflow-throws-this-exception-when-loading-a-model-that-was-normalized-li) in tf v2.6 without any issue.Please find the gist of it [here](https://colab.research.google.com/gist/tilakrayal/845d0574f6411100fc00255bfcfc0b62/un51911.ipynb).Also i can see your  tf v2.6 is installed with Cuda 11.4.2 which is incompatible.Please check the link for tested build [configurations](https://www.tensorflow.org/install/source#gpu) and try to install with compatible version.Thanks!\n\nYou forgot to edit that code and uncomment the part \u00a0#model\u00a0=\u00a0tf.keras.models.load_model('AI/test.h5') so that is where the problem begins. I tried your  gist and achieved same exception. You might wanna change the path dir from AI/test.h5 to just test.h5 since gist seems not to accept creating a sub folder. So run the code for the first time just as is, then for the second time uncomment that part and load the model then boom exception is thrown. I switched to the compatible versions as you mentioned and still the bug, note that there are 2 bugs I'm reporting, the second bug is the loss of accuracy when loading a model.", "@rafak360 ,\r\nPlease post this issue on [keras-team/keras](https://github.com/keras-team/keras/issues) repo.\r\nTo know more refer to:\r\n[https://discuss.tensorflow.org/t/keras-project-moved-to-new-repository-in-https-github-com-keras-team-keras/1999](https://discuss.tensorflow.org/t/keras-project-moved-to-new-repository-in-https-github-com-keras-team-keras/1999)\r\n", "> @rafak360 ,\r\n> Please post this issue on [keras-team/keras](https://github.com/keras-team/keras/issues) repo.\r\n> To know more refer to:\r\n> https://discuss.tensorflow.org/t/keras-project-moved-to-new-repository-in-https-github-com-keras-team-keras/1999\r\n\r\nDone: https://github.com/keras-team/keras/issues/15348", "@rafak360 ,\r\nPlease feel free to move this issue to closed status as it has been tracking in Keras repo.Thanks!", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51911\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51911\">No</a>\n"]}, {"number": 51910, "title": "Add support for lowering variadic mhlo.reduce op to lmhlo to LinAlg.", "body": "Support reduceOp multiple inputs in the following process\r\nmhlo.reduceOp lower to lhlo.reduce\r\nlhlo.reduce lower to linalg dialect multiple_operand", "comments": ["We found a Contributor License Agreement for you (the sender of this pull request), but were unable to find agreements for all the commit author(s) or Co-authors.  If you authored these, maybe you used a different email address in the git commits than was used to sign the CLA ([login here](https://cla.developers.google.com/) to double check)?  If these were authored by someone else, then they will need to sign a CLA as well, and confirm that they're okay with these being contributed to Google.\nIn order to pass this check, please resolve this problem and then comment `@googlebot I fixed it.`. If the bot doesn't comment, it means it doesn't think anything has changed.\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51910) for more info**.\n\n<!-- need_author_cla -->", "@googlebot I fixed it.", "We found a Contributor License Agreement for you (the sender of this pull request), but were unable to find agreements for all the commit author(s) or Co-authors.  If you authored these, maybe you used a different email address in the git commits than was used to sign the CLA ([login here](https://cla.developers.google.com/) to double check)?  If these were authored by someone else, then they will need to sign a CLA as well, and confirm that they're okay with these being contributed to Google.\nIn order to pass this check, please resolve this problem and then comment `@googlebot I fixed it.`. If the bot doesn't comment, it means it doesn't think anything has changed.\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51910) for more info**.\n\n<!-- need_author_cla -->", "@googlebot I fixed it.", "We found a Contributor License Agreement for you (the sender of this pull request), but were unable to find agreements for all the commit author(s) or Co-authors.  If you authored these, maybe you used a different email address in the git commits than was used to sign the CLA ([login here](https://cla.developers.google.com/) to double check)?  If these were authored by someone else, then they will need to sign a CLA as well, and confirm that they're okay with these being contributed to Google.\nIn order to pass this check, please resolve this problem and then comment `@googlebot I fixed it.`. If the bot doesn't comment, it means it doesn't think anything has changed.\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51910) for more info**.\n\n<!-- need_author_cla -->", "@googlebot I fixed it.", "We found a Contributor License Agreement for you (the sender of this pull request), but were unable to find agreements for all the commit author(s) or Co-authors.  If you authored these, maybe you used a different email address in the git commits than was used to sign the CLA ([login here](https://cla.developers.google.com/) to double check)?  If these were authored by someone else, then they will need to sign a CLA as well, and confirm that they're okay with these being contributed to Google.\nIn order to pass this check, please resolve this problem and then comment `@googlebot I fixed it.`. If the bot doesn't comment, it means it doesn't think anything has changed.\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51910) for more info**.\n\n<!-- need_author_cla -->", "@googlebot I fixed it.", "We found a Contributor License Agreement for you (the sender of this pull request), but were unable to find agreements for all the commit author(s) or Co-authors.  If you authored these, maybe you used a different email address in the git commits than was used to sign the CLA ([login here](https://cla.developers.google.com/) to double check)?  If these were authored by someone else, then they will need to sign a CLA as well, and confirm that they're okay with these being contributed to Google.\nIn order to pass this check, please resolve this problem and then comment `@googlebot I fixed it.`. If the bot doesn't comment, it means it doesn't think anything has changed.\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51910) for more info**.\n\n<!-- need_author_cla -->", "@googlebot I fixed it.", "We found a Contributor License Agreement for you (the sender of this pull request), but were unable to find agreements for all the commit author(s) or Co-authors.  If you authored these, maybe you used a different email address in the git commits than was used to sign the CLA ([login here](https://cla.developers.google.com/) to double check)?  If these were authored by someone else, then they will need to sign a CLA as well, and confirm that they're okay with these being contributed to Google.\nIn order to pass this check, please resolve this problem and then comment `@googlebot I fixed it.`. If the bot doesn't comment, it means it doesn't think anything has changed.\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51910) for more info**.\n\n<!-- need_author_cla -->", "@googlebot I fixed it.", "We found a Contributor License Agreement for you (the sender of this pull request), but were unable to find agreements for all the commit author(s) or Co-authors.  If you authored these, maybe you used a different email address in the git commits than was used to sign the CLA ([login here](https://cla.developers.google.com/) to double check)?  If these were authored by someone else, then they will need to sign a CLA as well, and confirm that they're okay with these being contributed to Google.\nIn order to pass this check, please resolve this problem and then comment `@googlebot I fixed it.`. If the bot doesn't comment, it means it doesn't think anything has changed.\n\n\u2139\ufe0f **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fpull%2F51910) for more info**.\n\n<!-- need_author_cla -->", "The commit author email is `lipracer@gemail.com` right now, I assumed this is a typo.\r\n", "Corrected", "Update and fix compilation errors gcc7", "@MaheshRavishankar Please review thanks.", "> @MaheshRavishankar Please review thanks.\r\n\r\nThis is going through internal review process. I'll ask Mahesh to help review it internally."]}, {"number": 51909, "title": "crash in (loading?) libtensorflow_framework.so.2", "body": "**System information**\r\n- No custom code - just loading\r\n- Ubuntu 20.0.4\r\n- Intel(R) Atom(TM) CPU D2500   @ 1.86GHz\r\n- Installed from Ubuntu release binary apt-get\r\n- Cannot determine (see below)\r\n- Python version: 3.8\r\n- CUDA/cuDNN version: None\r\n- GPU model and memory: None\r\n- Everything very \"stock\" - new, clean ground-up install from binary repos\r\n- CPU flags:  `fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts nopl nonstop_tsc cpuid aperfmperf pni dtes64 monitor ds_cpl tm2 ssse3 cx16 xtpr pdcm movbe lahf_lm dtherm arat`\r\n\r\nAny attempt to load TensorFlow Python module, or run `tensorboard` (no parameters - no files) results in Illegal Instruction crash.\r\n\r\nBoth crashes appear to be within `libtensorflow_framework.so.2` - possibly calling into `librt-2.31.so`\r\n\r\nSome sort of \"python\" core dump for `import tensorflow` here:\r\n[https://s3.amazonaws.com/s3.bradgoodman.com/_usr_bin_python3.8.0.crash](https://s3.amazonaws.com/s3.bradgoodman.com/_usr_bin_python3.8.0.crash)\r\n\r\nStandard Core dump for `tensorboard` crash here:\r\n[https://s3.amazonaws.com/s3.bradgoodman.com/tensorboard.core](https://s3.amazonaws.com/s3.bradgoodman.com/tensorboard.core)\r\n", "comments": ["Hi @bkgoodman!Could you please confirm the steps followed to do installation as I see the device in template does not follow AVX [instructions](https://en.wikipedia.org/wiki/Advanced_Vector_Extensions).You can find instructions for installing from Source [here.](https://www.tensorflow.org/install/source). Please also follow these similar i[ssues](https://github.com/tensorflow/tensorflow/issues/45744) for answer. ", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51909\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51909\">No</a>\n"]}, {"number": 51908, "title": "tf.pad crashes with large paddings", "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Linux Ubuntu 18.04\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: N/A\r\n- TensorFlow installed from (source or binary): binary\r\n- TensorFlow version (use command below): 2.6.0\r\n- Python version: 3.6.8\r\n- Bazel version (if compiling from source): N/A\r\n- GCC/Compiler version (if compiling from source): N/A\r\n- CUDA/cuDNN version: N/A\r\n- GPU model and memory: N/A\r\n\r\n**Describe the current behavior**\r\n`tf.pad` crashes when the argument \"paddings\" has large values.\r\n\r\n**Describe the expected behavior**\r\nExpect an exception to be thrown if the input `paddings` is unexpected.\r\n\r\n**Standalone code to reproduce the issue**\r\n```\r\nimport tensorflow as tf\r\ninput_tensor = tf.random.uniform([1, 32, 32, 3], dtype=tf.float32)\r\npaddings = [[125106557, 1415887920], [747509374, 2136925906], [413308538, 904601717], [1900762018, 831358864]]\r\nres = tf.pad(input_tensor,paddings)\r\n```\r\noutputs:\r\n```\r\n2021-09-09 12:46:38.123113: F tensorflow/core/framework/tensor_shape.cc:352] Check failed: 0 <= new_num_elements (0 vs. -1)\r\nAborted (core dumped)\r\n```\r\n", "comments": ["@lugalUrim Could you please have a look at the[ link](https://www.tensorflow.org/api_docs/python/tf/pad), and similar [issue](https://github.com/tensorflow/tensorflow/issues/42293) ,Please let us know if it helps ?Thanks!", "Yes, thanks @sushreebarsa for pointing to that. I will close this issue.", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51908\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51908\">No</a>\n", "In case of check failure, tensorflow should return an error gracefully instead of crash with undefined behaviors. Created a PR #51973 for the fix."]}, {"number": 51907, "title": "Failed to load the native TensorFlow runtime", "body": "\r\n\r\n**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Mac OS 10.9.5\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\r\n- TensorFlow installed from (source or binary):\r\n- TensorFlow version (use command below): 2.2.1\r\n- Python version: 3.6.4\r\n- Bazel version (if compiling from source):\r\n- GCC/Compiler version (if compiling from source):\r\n- CUDA/cuDNN version:\r\n- GPU model and memory:\r\n\r\n**Describe the current behavior**\r\n\r\nI have created a conda env with py 3.6.4 installing several dependencies. I wanted to install tensorflow 2.2.0rc4 but it was not available, instead I did 2.2.1. I got errors from gprcio saying:\r\n\r\n```\r\nBuilding wheels for collected packages: grpcio\r\n  Building wheel for grpcio (setup.py) ...\r\nERROR: Command errored out with exit status 1:\r\n```\r\nAnd a huge amount of other messages. Needless to say tf did not install.\r\n\r\nI thought I found a workaround by first installing with\r\n\r\n`pip3 install --no-cache-dir  --force-reinstall -Iv grpcio==1.24.3`\r\n\r\nThis succesfully installed and allowed me to succesfully install tf 2.2.1. Or so I thought.\r\n\r\nWhen I try import tensorflow I get these errors\r\n\r\n`Traceback (most recent call last):\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/pywrap_tensorflow.py\", line 58, in <module>\r\n    from tensorflow.python.pywrap_tensorflow_internal import *\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/pywrap_tensorflow_internal.py\", line 28, in <module>\r\n    _pywrap_tensorflow_internal = swig_import_helper()\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/pywrap_tensorflow_internal.py\", line 24, in swig_import_helper\r\n    _mod = imp.load_module('_pywrap_tensorflow_internal', fp, pathname, description)\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/imp.py\", line 243, in load_module\r\n    return load_dynamic(name, filename, file)\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/imp.py\", line 343, in load_dynamic\r\n    return _load(spec)\r\nImportError: dlopen(/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so, 6): Symbol not found: _SecKeyCopyExternalRepresentation\r\n  Referenced from: /Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/../libtensorflow_framework.2.dylib\r\n  Expected in: /System/Library/Frameworks/Security.framework/Versions/A/Security\r\n in /Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/../libtensorflow_framework.2.dylib\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/__init__.py\", line 41, in <module>\r\n    from tensorflow.python.tools import module_util as _module_util\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/__init__.py\", line 50, in <module>\r\n    from tensorflow.python import pywrap_tensorflow\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/pywrap_tensorflow.py\", line 69, in <module>\r\n    raise ImportError(msg)\r\nImportError: Traceback (most recent call last):\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/pywrap_tensorflow.py\", line 58, in <module>\r\n    from tensorflow.python.pywrap_tensorflow_internal import *\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/pywrap_tensorflow_internal.py\", line 28, in <module>\r\n    _pywrap_tensorflow_internal = swig_import_helper()\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/pywrap_tensorflow_internal.py\", line 24, in swig_import_helper\r\n    _mod = imp.load_module('_pywrap_tensorflow_internal', fp, pathname, description)\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/imp.py\", line 243, in load_module\r\n    return load_dynamic(name, filename, file)\r\n  File \"/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/imp.py\", line 343, in load_dynamic\r\n    return _load(spec)\r\nImportError: dlopen(/Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so, 6): Symbol not found: _SecKeyCopyExternalRepresentation\r\n  Referenced from: /Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/../libtensorflow_framework.2.dylib\r\n  Expected in: /System/Library/Frameworks/Security.framework/Versions/A/Security\r\n in /Users/nsabherwal/anaconda3/envs/test/lib/python3.6/site-packages/tensorflow/python/../libtensorflow_framework.2.dylib\r\n\r\n\r\nFailed to load the native TensorFlow runtime.\r\n\r\nSee https://www.tensorflow.org/install/errors\r\n\r\nfor some common reasons and solutions.  Include the entire stack trace\r\nabove this error message when asking for help.`\r\n\r\n**Describe the expected behavior**\r\n\r\nExpect simple install and running of tensorflow.\r\n\r\n**[Contributing](https://www.tensorflow.org/community/contribute)**\r\n\r\n- Do you want to contribute a PR? (yes/no):\r\n- Briefly describe your candidate solution(if contributing):\r\n\r\n**Standalone code to reproduce the issue**\r\nProvide a reproducible test case that is the bare minimum necessary to generate\r\nthe problem. If possible, please share a link to Colab/Jupyter/any notebook.\r\n\r\n\r\n**Other info / logs** Include any logs or source code that would be helpful to\r\ndiagnose the problem. If including tracebacks, please include the full\r\ntraceback. Large logs and files should be attached.\r\n", "comments": ["From the template it looks like you are installing **TensorFlow** (TF) prebuilt binaries:\n   * For TF-GPU - See point 1\n   * For TF-CPU - See point 2\n-----------------------------------------------------------------------------------------------\n**1. Installing **TensorFlow-GPU** (TF) prebuilt binaries**\n\nMake sure you are using compatible TF and CUDA versions. Please refer following TF version and CUDA version compatibility table.\n| TF  | CUDA |\n| :-------------: | :-------------: |\n| 2.5.0  | 11.2 |\n| 2.4.0  | 11.0 |\n| 2.1.0 - 2.3.0  | 10.1 |\n| 1.13.1 - 2.0  | 10.0  |\n| 1.5.0 - 1.12.0 | 9.0 |\n\n  * If you have above configuration and using _**Windows**_ platform -\n    * Try adding the CUDA, CUPTI, and cuDNN installation directories to the %PATH% environment variable.\n    * Refer [windows setup guide](https://www.tensorflow.org/install/gpu#windows_setup).\n  * If you have above configuration and using _**Ubuntu/Linux**_ platform -\n    * Try adding the CUDA, CUPTI, and cuDNN installation directories to the $LD_LIBRARY_PATH environment variable.\n    * Refer [linux setup guide](https://www.tensorflow.org/install/gpu#linux_setup).\n  * If error still persists then, apparently your CPU model does not support AVX instruction sets.\n    * Refer [hardware requirements](https://www.tensorflow.org/install/pip#hardware-requirements).\n\n-----------------------------------------------------------------------------------------------\n**2. Installing **TensorFlow** (TF) CPU prebuilt binaries**\n\n*TensorFlow release binaries version 1.6 and higher are prebuilt with AVX instruction sets.*\n\nTherefore on any CPU that does not have these instruction sets, either CPU or GPU version of TF will fail to load.\nApparently, your CPU model does not support AVX instruction sets. You can still use TensorFlow with the alternatives given below:\n\n   * Try Google Colab to use TensorFlow.\n      * The easiest way to use TF will be to switch to [google colab](https://colab.sandbox.google.com/notebooks/welcome.ipynb#recent=true). You get pre-installed latest stable TF version. Also you can use ```pip install```  to install any other preferred TF version.\n      * It has an added advantage since you can you easily switch to different hardware accelerators (cpu, gpu, tpu) as per the task.\n      * All you need is a good internet connection and you are all set.\n   * Try to build TF from sources by changing CPU optimization flags.\n\n*Please let us know if this helps.*\n", "@bulgarianboy ,\r\nCould you please update TensorFlow to the latest stable version v2.6 and let us know if you are facing the same error. Thanks!", "Also please check the tested build [configurations](https://www.tensorflow.org/install/source#gpu) and try to install latest tensorflow version with compatible Cuda and cudnn.Thanks!", "This issue has been automatically marked as stale because it has no recent activity. It will be closed if no further activity occurs. Thank you.\n", "Closing as stale. Please reopen if you'd like to work on this further.\n", "Are you satisfied with the resolution of your issue?\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=Yes&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51907\">Yes</a>\n<a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfaP12TRhd9xSxjXZjcZFNXPGk4kc1-qMdv3gc6bEP90vY1ew/viewform?entry.85265664=No&entry.2137816233=https://github.com/tensorflow/tensorflow/issues/51907\">No</a>\n"]}]